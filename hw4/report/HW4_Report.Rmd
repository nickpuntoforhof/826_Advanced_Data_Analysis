---
title: "BMI 826 - Homework 4"
output: html_notebook
author: "Noah Stafford"
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

```{r, include=FALSE}
# libraries
library(tidyverse)
library(readxl)
# Setwd
setwd("C:/Users/woody/Google Drive/github_repos/826_Advanced_Data_Analysis/hw4")
```

Let's look at what the data looks like right after its imported.
```{r, echo=FALSE}
# Clean data and save to .RData file
nh_diab <- read.csv('../rawData/nhanes_diabetes.csv', stringsAsFactors = FALSE)
summary(nh_diab)
```
From the summary output, it's clear that this is pretty clean data. As a rule of thumb, when a column is imported into an R dataframe and is automatically coerced to an int/numeric with correclty coded NA's, that eliminates the possiblity of a wide array of potential problems with that column.  For instance, there can be no text, NAs coded a different way than expected, or certain types of typos.  There can still be errors/outlier within the values of a column, but the output above is telling me that most of the data cleaning work has been done already.

Now let's look at the data to get a sense of what we have:
```{r, echo = FALSE}
nh_diab_plot <- nh_diab %>% gather(key = "covariate", value = "value", -id)
covariate_names <- colnames(nh_diab)

ggplot(nh_diab_plot %>% filter(covariate %in% covariate_names[2:10]), aes(x=value)) + geom_histogram() + facet_wrap(~covariate, scales = "free", ncol=3) + theme_light()

ggplot(nh_diab_plot %>% filter(covariate %in% covariate_names[11:length(covariate_names)]), aes(x=value)) + geom_histogram() + facet_wrap(~covariate, scales = "free", ncol=3) + theme_light()
```
Some notes: alcohol appears to have a lot of zeros with sparse values higher than about 20 being sparse.  In all, this seems to be very good data.  There are clear normal distributions were they are expected, and the dataset appears to have been gathered from a population that is diverse demographically, with a large amount of observations for each category of each covariate.

There appears to be an odd encoding for age_smoking, where 0 designates "never smoked cigarettes regularly". Since this is a population of people with non-smokers, this covariate is really an interaction term between the age started smoking and smoker/non-smoker.  Deriving a smoker/non-smoker variable from this covariate will probably be informative.

household_income also displays an odd deviation from normality, which a large spike in density at value 11, which is encoded as income >= 75k, which was clearly too low of a threshold to abandon the windowing system that was used to encode the previous 10 variables, as a large portion of the distribution has been compressed into this category.  Furthermore, value 12 and value 13 represent patients where less information is known about there income, giving a simple > 20k or < 20k income for these patients.  

The issue, of course, is that perhaps the least balanced variable in the dataset is the one we are trying to predict.  The datset has 1,000 instances of people who have "heavy work" for their activity, but how many of those people are diabetic?
```{r, echo = FALSE}
nh_diab_plot_diab <- nh_diab %>% gather(key = "covariate", value = "value", -c(id,diabetic))
covariate_names <- unique(nh_diab_plot_diab$covariate)

ggplot(nh_diab_plot %>% filter(covariate %in% covariate_names[1:3]), aes(x=value)) + geom_histogram() + facet_wrap(covariate~diabetic, scales = "free", ncol=2) + theme_light()

ggplot(nh_diab_plot %>% filter(covariate %in% covariate_names[4:6]), aes(x=value)) + geom_histogram() + facet_wrap(covariate~diabetic, scales = "free", ncol=2) + theme_light()

ggplot(nh_diab_plot %>% filter(covariate %in% covariate_names[7:9]), aes(x=value)) + geom_histogram() + facet_wrap(covariate~diabetic, scales = "free", ncol=2) + theme_light()

ggplot(nh_diab_plot %>% filter(covariate %in% covariate_names[10:12]), aes(x=value)) + geom_histogram() + facet_wrap(covariate~diabetic, scales = "free", ncol=2) + theme_light()

ggplot(nh_diab_plot %>% filter(covariate %in% covariate_names[13:15]), aes(x=value)) + geom_histogram() + facet_wrap(covariate~diabetic, scales = "free", ncol=2) + theme_light()

ggplot(nh_diab_plot %>% filter(covariate %in% covariate_names[16]), aes(x=value)) + geom_histogram() + facet_wrap(covariate~diabetic, scales = "free", ncol=2) + theme_light()
```

By splitting the histograms on the response variable, we're looking for covariables with few observations within one category.  It can  be seen that we're getting only about 20 observations in some of the income bins for the diabetic patients.  The income bins needs to be widened, and the 12th and 13th bins need to either be incorporated to create a strictly ordinal variable.  The other issue is some of the (other) race categories, specifically 2 and 5, have under 100 observations for diabetics.  I'm not too concerned about this, but I think the best thing to do is to lump the 'other hispanic' in with 'mexican american', and leave 'other' alone.

```{r, insert=FALSE}
nh_diab$smoker <- ifelse(nh_diab$age_smoking == 0, 0, 1)
nh_diab$income_bins <- ifelse(nh_diab$household_income %in% c(1,2,3,4,13), 'low',
                                   ifelse(nh_diab$household_income %in% c(5,6,7,8,12), 'middle', 'high'))
```

